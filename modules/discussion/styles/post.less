@import 'settings/colors.less';
@import 'settings/typography.less';
@import 'mediawiki.mixins.less';
@import 'mixins/moderation.less';
@import '../../base/styles/settings/paths.less';
@import '../../base/styles/mixins/wordbreak.less';

.flow-post-container {
	clear: both;

	.flow-post {
		margin: 12px 0;
		padding-left: 16px;

		.flow-icon {
			opacity: 0.5;
		}

		// default visibility
		.flow-post-content,
		.flow-datestamp {
			display: block;
		}
		.flow-edit-form {
			display: none;
		}

		// when edit form is displayed, class .flow-edit-form-active will be added,
		// so we can show/hide elements as needed
		&.flow-edit-form-active {
			.flow-post-content,
			.flow-datestamp {
				display: none;
			}
			.flow-edit-form {
				display: block;
			}
		}
	}

	.flow-post-summary {
		padding: 5px 20px;
		font-size: 14px;
		font-weight: normal;
		font-style: italic;
		background: none repeat scroll 0 0 #EDEDED;
	}

	.flow-post-main {
		position: relative;
	}

	.flow-post-title {
		padding-top: 10px;
		padding-bottom: 8px;

		// overwrite default 22px margin-bottom, because this element's height
		// will affect the position of .flow-edit-post-link
		.flow-creator {
			margin-bottom: 0;

			& > a {
				// This makes the highlighting be slightly wider
				// than the text without affecting the alignment.
				margin-left: -3px;
				padding-left: 3px;
				padding-right: 3px;
			}
		}
	}

	.flow-post-own {
		.flow-creator > a {
			// username color at 20% transparency
			background-color: rgba(60, 104, 177, 0.2);
		}
	}

	.flow-post-content {
		font-weight: normal;
		color: @post-content-color;
		max-height: 2000px;
		overflow: auto;
		// force wordbreaks, don't allow extra long text to break out
		// of the content box.
		.wordbreak-all();

		*:first-child {
			margin-top: 0;
		}

		*:last-child {
			margin-bottom: 0;
		}

		ul {
			list-style-image: none;
		}

		// show [1], [2], ... for empty external links
		counter-reset: flow-mwNumberedExternalLinkNode;
		a[rel~="mw:ExtLink"]:empty:after {
			content: "[" counter(flow-mwNumberedExternalLinkNode) "]";
			counter-increment: flow-mwNumberedExternalLinkNode;
		}


		// Make the last paragraph of a post inline in case we put a
		// "content-modified" icon after it.
		p:last-of-type {
			display: inline;
		}

		.flow-content-modified-tipsy-flyout {
			display: none;
		}

		padding-right: 22px;
	}

	.flow-post-interaction {
		padding-top: 11px;
		font-size: @post-interaction-font-size;
		color: @post-interaction-color;

		// The quiet buttons are rendered into inline text by resetting most of the
		// .mw-ui-button box and shadow styling.
		.mw-ui-quiet {
			border: none;
			padding: 0;
			background: none;
			font-weight: normal;

			box-shadow: none;
			-webkit-box-shadow: none;
			-moz-box-shadow: none;

			// Buttons are implemented with anchor tags instead of button tags,
			// so they cannot be disabled with the :disabled property.
			// A css class is needed for proper styling of 'disabled' state.
			&.mw-ui-disabled {
				cursor: default;
				color: @post-interaction-disabled-color;
			}
		}
	}

	.flow-post-interaction-separator {
		display: inline-block;
		margin-left: 8px;
		margin-right: 8px;
		padding: 0;
	}

	.flow-datestamp {
		position: absolute;
		right: 22px;
		bottom: 5px;
		margin: 0;

		a {
			color: inherit;
		}
	}

	.flow-actions {
		position: relative;
	}

	.flow-tipsy-flyout {
		position: absolute;
		top: -50px;
		right: 0;
	}

	.flow-tipsy-link {
		position: absolute;
		right: 22px;
		top: 10px;
		z-index: 99;

		width: 20px;
		height: 20px;
		text-indent: -9999px;

		background-position: center;
		background-size: 20px auto;
		background-repeat: no-repeat;
		.background-image-svg( ~"@{icon-path}ellipsis_gray.svg", ~"@{icon-path}ellipsis_gray.png" );

		&:hover {
			.background-image-svg( ~"@{icon-path}ellipsis_lightgray.svg", ~"@{icon-path}ellipsis_lightgray.png" );
		}

		&:active {
			.background-image-svg( ~"@{icon-path}ellipsis_darkgray.svg", ~"@{icon-path}ellipsis_darkgray.png" );
		}
	}

	.flow-post-moderated {
		.flow-tipsy-link {
			display: none;
		}
		&.flow-post-moderated-visible {
			.flow-tipsy-link {
				display: block;
			}
		}
	}

	// any non-first-level reply
	.flow-post-replies {
		font-size: 14px;

		margin-left: 22px;
		border-left: 2px dotted #CCC;
	}

	/*
	 * Although the reply form is not displayed if a reply would violate
	 * threading depth, there may be legacy data (e.g. when decreasing threading
	 * depth) where we need to flatten out deeper threaded replies.
	 */
	.flow-post-max-depth {
		.flow-post-replies {
			border-left: 0px solid transparent;
			margin-left: 0px;
		}
	}

	.flow-thank-link {
		padding-left: 41px;

		.background-image-svg( ~"@{icon-path}thank.svg", ~"@{icon-path}thank.png" );
		background-position: 12px;
		background-size: 20px auto;
		background-repeat: no-repeat;
	}

	.flow-post-reply-container {
		padding: 10px 0 10px 22px;
		display: none;

		&.flow-reply-form-active {
			display: block;
		}
	}

	.flow-reply-form,
	.flow-edit-form {
		.flow-form-controls {
			margin-top: 5px;
			text-align: right;
		}

		textarea {
			width: 100%;
			/*
			 * The textarea has some padding for the text; make it easier to define the
			 * exact length. box-sizing defines what the length is applied to. We want it
			 * to include padding & border, so border-box it is (the default value,
			 * content-box, applies length to content, making the textarea larger if e.g.
			 * padding is defined)
			 */
			box-sizing: border-box;
			-moz-box-sizing: border-box;

			font-family: sans-serif;
		}
	}

	.flow-post-moderated {
		.flow-post-moderated-message {
			color: #aaa;
			padding: 0;
			font-weight: bold;

			a {
				text-decoration: none;
				line-height: 18px;

				&:hover {
					text-decoration: underline;
				}
			}

			// turn show/hide link gray
			.flow-post-moderated-view {
				color: #aaa;
			}

			// hide user links until hovered
			.mw-usertoollinks {
				color: @post-title-color;
				opacity: 0;
				transition: opacity 0.2s;
			}
			&:hover {
				.mw-usertoollinks {
					opacity: 1;
				}
			}

			&.flow-post-moderated-hide,
			&.flow-post-moderated-delete,
			&.flow-post-moderated-suppress {
				padding-left: 22px;

				background-position: left;
				background-size: 14px auto;
				background-repeat: no-repeat;
			}

			&.flow-post-moderated-hide {
				.flow-moderated-element-icon( "hidden" );
			}

			&.flow-post-moderated-delete {
				.flow-moderated-element-icon( "deleted" );
			}

			&.flow-post-moderated-suppress {
				.flow-moderated-element-icon( "suppressed" );
			}

			span.flow-post-moderated-view {
				cursor: pointer;
			}
		}

		&.flow-post-moderated-visible {
			.flow-post-moderated-message {
				&.flow-post-moderated-hide {
					.background-image-svg( ~"@{icon-path}hidden_active.svg", ~"@{icon-path}hidden_active.png" );
				}

				&.flow-post-moderated-delete {
					.background-image-svg( ~"@{icon-path}deleted_active.svg", ~"@{icon-path}deleted_active.png" );
				}

				&.flow-post-moderated-suppress {
					.background-image-svg( ~"@{icon-path}suppressed_active.svg", ~"@{icon-path}suppressed_active.png" );
				}
			}
		}

		.flow-post-main {
			// hide post if it's been moderated (can be toggled back via JS)
			display: none;

			color: #aaa;

			// hide non-essential elements
			.flow-datestamp {
				display: none;
			}
		}

		.flow-post-moderated-show-message, .flow-post-moderated-hide-message {
			display: none;
		}
	}

	.flow-post {
		border-left: 6px solid transparent;
	}

	&.flow-post-highlighted > .flow-post {
		border-left: 6px solid #00AF89
	}

	.flow-post-nocontrols .flow-post-interaction {
		display: none;
	}
}
