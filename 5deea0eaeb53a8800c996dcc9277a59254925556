{
  "comments": [
    {
      "key": {
        "uuid": "0ee75395_e27766ce",
        "filename": "includes/DbFactory.php",
        "patchSetId": 1
      },
      "lineNbr": 32,
      "author": {
        "id": 113
      },
      "writtenOn": "2013-11-20T20:03:21Z",
      "side": 1,
      "message": "I would wrap this as callback for onTransactionIdle() so it doesn\u0027t implicitly commit other transaction",
      "revId": "5deea0eaeb53a8800c996dcc9277a59254925556",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ee75395_3f15609d",
        "filename": "includes/DbFactory.php",
        "patchSetId": 1
      },
      "lineNbr": 32,
      "author": {
        "id": 776
      },
      "writtenOn": "2013-11-21T21:59:53Z",
      "side": 1,
      "message": "I think thats what we want here,\n\n$dbw-\u003ebegin() should have implicitly closed any transaction that was already open(mysql supports nested transactions via savepoint/rollback to, but apparently mediawiki does not)\n\nThat should mean the only transaction that can possibly be open is our own, unless something inside $callback started its own transaction.  I suppose thats possible, since $callback can be anything, but i would call that a bug to be fixed.",
      "parentUuid": "0ee75395_e27766ce",
      "revId": "5deea0eaeb53a8800c996dcc9277a59254925556",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ee75395_e2a2bba3",
        "filename": "includes/DbFactory.php",
        "patchSetId": 1
      },
      "lineNbr": 32,
      "author": {
        "id": 113
      },
      "writtenOn": "2013-11-21T23:23:32Z",
      "side": 1,
      "message": "Transaction should not be committed implicitly.  If this code block is already inside a mediawiki transaction,  $dbw-\u003ebegin() would close the transaction unintentionally.",
      "parentUuid": "0ee75395_3f15609d",
      "revId": "5deea0eaeb53a8800c996dcc9277a59254925556",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ee75395_76d2ead6",
        "filename": "includes/DbFactory.php",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 113
      },
      "writtenOn": "2013-11-23T01:08:23Z",
      "side": 1,
      "message": "There is another hack we can do.\n\nWe can have the bufferedCache commit execute in deferred update, eg: DeferredUpdates::addCallableUpdate( function() { commit() } ), this will be executed after primary db connections have been committed.  In that case, we can remove db-\u003ebegin and db-\u003ecommit, cache will only be committed if data is written into the db successfully",
      "revId": "5deea0eaeb53a8800c996dcc9277a59254925556",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    }
  ]
}